name: pets-care

services:
  ms-config:
    image: juancazz/petscare-ms-config:latest
    container_name: ms-config
    restart: always
    networks:
      - pets-care-network
    ports:
      - 8888:8888
    environment:
      - MS_CONFIG_SERVER_GIT_URI=https://github.com/Juancazzhr/Pets-Care.git
      - MS_CONFIG_SERVER_GIT_DEFAULT_LABEL=dev
      - MS_CONFIG_PORT=8888
    healthcheck:
      test: [ "CMD", "curl -s -o /dev/null -w '%{http_code}' http://localhost:8888/actuator/health | grep -q 200" ]
      start_period: 6s
      timeout: 10s
      retries: 2
      interval: 10s

  ms-discovery:
    image: juancazz/petscare-ms-discovery:latest
    container_name: ms-discovery
    restart: always
    depends_on:
      ms-config:
        condition: service_healthy
    networks:
      - pets-care-network
    ports:
      - 8761:8761
    environment:
      - MS_DISCOVERY_PORT=8761
      - MS_DISCOVERY_CONFIG_SERVER_URL=http://ms-config:8888
      - MS_DISCOVERY_PROFILE_ACTIVE=dev
    healthcheck:
      test: [ "CMD", "curl -s -o /dev/null -w '%{http_code}' http://localhost:8761/actuator/health | grep -q 200" ]
      start_period: 6s
      timeout: 10s
      retries: 2
      interval: 10s

  ms-gateway:
    image: juancazz/petscare-ms-gateway:latest
    container_name: ms-gateway
    restart: always
    depends_on:
      ms-config:
        condition: service_healthy
      ms-discovery:
        condition: service_healthy
    networks:
      - pets-care-network
    ports:
      - 8080:8080
    environment:
      - MS_GATEWAY_CONFIG_SERVER_URL=http://ms-config:8888
      - MS_GATEWAY_PROFILE_ACTIVE=dev
      - MS_GATEWAY_SERVICE_URL=http://ms-discovery:8761/eureka
      - MS_GATEWAY_PORT=8080
    healthcheck:
      test: [ "CMD", "curl -s -o /dev/null -w '%{http_code}' http://localhost:8080/actuator/health | grep -q 200" ]
      start_period: 6s
      timeout: 10s
      retries: 2
      interval: 10s

networks:
  pets-care-network:
    name: pets-care-network